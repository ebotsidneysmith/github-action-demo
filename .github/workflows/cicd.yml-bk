name: Node.js CI/CD Pipeline

on:
  push:
    branches:
      - "*"

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install dependencies
        run: npm install

      - name: Build Docker image
        run: docker build -t my-node-app:latest .

  unit-test:
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Run unit tests
        run: npm test

  integration-test:
    runs-on: ubuntu-latest
    needs: unit-test
    steps:
      - name: Integration test (dummy step)
        run: echo "ğŸ”— Integration tests passed!"

  # ---------- DEV ----------
  deploy-dev:
    runs-on: ubuntu-latest
    needs: integration-test
    steps:
      - name: Deploy to Dev
        run: echo "ğŸš€ Deploying to Dev..."

  smoke-test-dev:
    runs-on: ubuntu-latest
    needs: deploy-dev
    steps:
      - name: Smoke Test (Dev)
        run: curl -s http://example.com || echo "ğŸ’¨ Smoke test simulated!"

  functional-test-dev:
    runs-on: ubuntu-latest
    needs: [deploy-dev, smoke-test-dev]
    steps:
      - name: Functional Test (Dev)
        run: echo "âš™ï¸ Functional test simulated for Dev"

  regression-test-dev:
    runs-on: ubuntu-latest
    needs: functional-test-dev
    steps:
      - name: Regression Test (Dev)
        run: echo "ğŸ” Regression test simulated for Dev"

  # ---------- UAT ----------
  deploy-uat:
    runs-on: ubuntu-latest
    needs: regression-test-dev
    steps:
      - name: Deploy to UAT
        run: echo "ğŸš€ Deploying to UAT..."

  smoke-test-uat:
    runs-on: ubuntu-latest
    needs: deploy-uat
    steps:
      - name: Smoke Test (UAT)
        run: echo "ğŸ’¨ Smoke test simulated for UAT"

  functional-test-uat:
    runs-on: ubuntu-latest
    needs: [deploy-uat, smoke-test-uat]
    steps:
      - name: Functional Test (UAT)
        run: echo "âš™ï¸ Functional test simulated for UAT"

  regression-test-uat:
    runs-on: ubuntu-latest
    needs: functional-test-uat
    steps:
      - name: Regression Test (UAT)
        run: echo "ğŸ” Regression test simulated for UAT"

  # ---------- PROD ----------
  deploy-prod:
    runs-on: ubuntu-latest
    needs: regression-test-uat
    steps:
      - name: Deploy to Prod
        run: echo "ğŸš€ Deploying to Prod..."

  smoke-test-prod:
    runs-on: ubuntu-latest
    needs: deploy-prod
    steps:
      - name: Smoke Test (Prod)
        run: echo "ğŸ’¨ Smoke test simulated for Prod"

  functional-test-prod:
    runs-on: ubuntu-latest
    needs: [deploy-prod, smoke-test-prod]
    steps:
      - name: Functional Test (Prod)
        run: echo "âš™ï¸ Functional test simulated for Prod"

  regression-test-prod:
    runs-on: ubuntu-latest
    needs: functional-test-prod
    steps:
      - name: Regression Test (Prod)
        run: echo "ğŸ” Regression test simulated for Prod"
